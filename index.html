<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join</title>
    <link rel="icon" type="image/x-icon" href="./assets/img/logo_coloured.svg">
    <link rel="stylesheet" href="./css/side_menu.css">
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/login-signup.css">
    <script src="./js/signupdatabase.js"></script>
    <script src="./js/signup.js"></script>
    <script src="./js/contactsfirebase.js"></script>
    <script src="js/login.js"></script>
</head>
<body>
    <img class="logo-launch" src="imgs/join_logo_dark.png" alt="logo of Join">
    <section class="container-login-signup dflex-c-c screen-animation">
        <div class="log-in-overlay dflex-c-c column">
            <div class="dflex-c-c column">
                <h1>Log in</h1>
                <div class="text-segment"></div>
            </div>
            <form class="input-container dflex-c-c column" id="addContactForm" onsubmit="login(event)">
                <input id="email" class="inputfield" type="text" placeholder="Email" onblur="validateEditField('email')" required="" onkeyup="if (event.key === 'Enter') login(event)">
                <div id="emailError" class="error-message"></div>
            
                <input id="password" class="inputfield" type="password" placeholder="Passwort" onblur="validateEditField('password')" required="" onkeyup="if (event.key === 'Enter') login(event)">
                <div id="passwordError" class="error-message"></div>
            
                <div id="Loginerror" class="d-none"></div>
                <button type="button" class="btn-small cursor-pointer" onclick="login(event)">Log in</button>
            </form>
            <a onclick="guestLogin()" href="./summary.html">
                <button type="button" class="btn-outline cursor-pointer">Guest Log in</button>
            </a>
        </div>
    </section>

    <section class="login-head screen-animation">
        <div class="login-head-top-right dflex-c-c">
            <span>Not a Join user?</span>
            <a href="./sign_up.html">
                <button class="btn-small fz-16px cursor-pointer">Sign up</button>
            </a>
        </div>
    </section>

    <section class="login-footer dflex-c-c screen-animation">
        <a href="./privacy-police.html">Privacy Policy</a>
        <a href="./legal_notice.html">Legal Notice</a>
    </section>

    <script src="js/signup.js"></script>
    <script>

    // Fügt einen Event-Listener für alle Eingabefelder hinzu, um Fehleranzeige zu entfernen, wenn der Benutzer tippt
    // Der 'DOMContentLoaded' Event stellt sicher, dass der Code erst ausgeführt wird, wenn die gesamte HTML-Struktur geladen ist.
    document.addEventListener('DOMContentLoaded', function () {
        const inputs = document.querySelectorAll('.inputfield'); // Wählt alle Eingabefelder mit der Klasse 'inputfield'
        inputs.forEach(input => {
            input.addEventListener('input', removeErrorStyling); // Bei Eingabe wird die Funktion 'removeErrorStyling' aufgerufen
        });
    });
    
    /**
     * Entfernt die roten Fehlerstile und versteckt die Fehlermeldung, wenn der Benutzer Text eingibt.
     * Diese Funktion wird aufgerufen, wenn der Benutzer in ein Eingabefeld schreibt.
     * @param {Event} event - Das Eingabeereignis des Benutzers.
     */
    function removeErrorStyling(event) {
        const inputField = event.target; // Das Eingabefeld, das das Ereignis ausgelöst hat
        inputField.classList.remove('error'); // Entfernt die 'error'-Klasse, um das rote Rand-Styling zu löschen.
        
        const errorElement = document.getElementById(`${inputField.id}Error`); // Sucht nach dem Fehlertext-Element, das dem Eingabefeld zugeordnet ist.
        if (errorElement) {
            errorElement.innerText = ''; // Setzt die Fehlermeldung zurück.
            errorElement.style.display = 'none'; // Versteckt das Fehler-Element.
        }
    }
    
    // Zeigt eine Fehlermeldung an, wenn das Eingabefeld ungültige Daten enthält
    // Diese Funktion wird aufgerufen, wenn ein Fehler für ein Eingabefeld angezeigt werden soll.
    function showErrorMessage(errorElementId, message) {
        const errorElement = document.getElementById(errorElementId); // Sucht das Fehler-Element basierend auf der ID
        errorElement.innerText = message; // Setzt die Fehlermeldung
        errorElement.style.color = 'red'; // Stellt sicher, dass der Text rot ist, um ihn hervorzuheben
        errorElement.style.display = 'block'; // Zeigt das Fehler-Element an
    }
    
    // Versteckt die Fehlermeldung für das angegebene Fehler-Element
    // Diese Funktion wird aufgerufen, wenn der Fehler entfernt werden soll.
    function hideErrorMessage(errorElementId) {
        const errorElement = document.getElementById(errorElementId); // Sucht das Fehler-Element basierend auf der ID
        errorElement.innerText = ''; // Entfernt die Fehlermeldung
    }
    
    // Überprüft die Eingabe eines Benutzers, basierend auf dem Typ der Variable (z.B. 'email' oder 'password')
    // Diese Funktion wird für jedes Eingabefeld aufgerufen, um die Gültigkeit zu prüfen.
    function validateInput(variable, value) {
        if (variable === "email") {
            // Überprüft, ob die E-Mail-Adresse im richtigen Format ist
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
            return emailPattern.test(value); // Gibt true zurück, wenn die E-Mail gültig ist
        }
        if (variable === "password") {
            return validatePassword(value); // Validiert das Passwort mit einer eigenen Funktion
        }
        return false; // Gibt false zurück, wenn kein unterstützter Wert übergeben wurde
    }
    
    // Validiert das Passwort anhand von bestimmten Kriterien (mindestens 8 Zeichen, Großbuchstaben, Kleinbuchstaben, Zahlen und Sonderzeichen)
    function validatePassword(password) {
        const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
        return passwordPattern.test(password); // Gibt true zurück, wenn das Passwort den Kriterien entspricht
    }
    
    // Überprüft das Eingabefeld auf Fehler und zeigt eine Fehlermeldung an, falls die Eingabe ungültig ist
    // Diese Funktion wird für jedes Eingabefeld aufgerufen, um die Eingabe zu validieren und die Fehler anzuzeigen.
    function validateEditField(fieldID) {
        let errottext = checkErrorText(fieldID); // Holt den passenden Fehlertext für das Feld
    
        if (!validateInput(fieldID, document.getElementById(fieldID).value)) {
            showErrorMessage(`${fieldID}Error`, `${errottext}`); // Zeigt die Fehlermeldung an
        } else {
            hideErrorMessage(`${fieldID}Error`); // Versteckt die Fehlermeldung, wenn die Eingabe korrekt ist
        }
    }
    
    // Gibt den Fehlertext zurück, der für das jeweilige Eingabefeld angezeigt werden soll
    // Diese Funktion wird aufgerufen, um spezifische Fehlermeldungen für E-Mail und Passwort zu definieren.
    function checkErrorText(fieldID) {
        if (fieldID === "email") {
            return "Email or password is not correct! "; // Fehlertext für ungültige E-Mail
        } else if (fieldID === "password") {
            return "Email or password is not correct! ."; // Fehlertext für ungültiges Passwort
        }
    }
</script>

</body>
</html>
