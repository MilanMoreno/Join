<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join</title>
    <link rel="icon" type="image/x-icon" href="./assets/img/logo_coloured.svg">
    <link rel="stylesheet" href="./css/side_menu.css">
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/login-signup.css">
    <script src="./js/signupdatabase.js"></script>
    <script src="./js/signup.js"></script>
    <script src="./js/contactsfirebase.js"></script>
    <script src="js/login.js"></script>
</head>
<body>
    <img class="logo-launch" src="imgs/join_logo_dark.png" alt="logo of Join">
    <section class="container-login-signup dflex-c-c screen-animation">
        <div class="log-in-overlay dflex-c-c column">
            <div class="dflex-c-c column">
                <h1>Log in</h1>
                <div class="text-segment"></div>
            </div>
            <form class="input-container dflex-c-c column" id="addContactForm" onsubmit="login(event)">
                <input id="email" class="inputfield" type="text" placeholder="Email" onblur="validateEditField('email')" required="" onkeyup="if (event.key === 'Enter') login(event)">
                <div id="emailError" class="error-message"></div>
            
                <input id="password" class="inputfield" type="password" placeholder="Passwort" onblur="validateEditField('password')" required="" onkeyup="if (event.key === 'Enter') login(event)">
                <div id="passwordError" class="error-message"></div>
            
                <div id="Loginerror" class="d-none"></div>
                <button type="button" class="btn-small cursor-pointer" onclick="login(event)">Log in</button>
            </form>
            <a onclick="guestLogin()" href="./summary.html">
                <button type="button" class="btn-outline cursor-pointer">Guest Log in</button>
            </a>
        </div>
    </section>

    <section class="login-head screen-animation">
        <div class="login-head-top-right dflex-c-c">
            <span>Not a Join user?</span>
            <a href="./sign_up.html">
                <button class="btn-small fz-16px cursor-pointer">Sign up</button>
            </a>
        </div>
    </section>

    <section class="login-footer dflex-c-c screen-animation">
        <a href="./privacy-police.html">Privacy Policy</a>
        <a href="./legal_notice.html">Legal Notice</a>
    </section>

    <script src="js/signup.js"></script>
    <script>

 /**
 * Adds event listeners to input fields for removing error styling when the user types.
 * The 'DOMContentLoaded' event ensures the code runs only after the entire HTML structure is loaded.
 */
document.addEventListener('DOMContentLoaded', function () {
    const inputs = document.querySelectorAll('.inputfield'); // Selects all input fields with the class 'inputfield'
    inputs.forEach(input => {
        input.addEventListener('input', removeErrorStyling); // On input, calls 'removeErrorStyling' function
    });
});

/**
 * Removes the red error styling and hides the error message when the user types in an input field.
 * 
 * @param {Event} event - The input event triggered by the user in the input field.
 */
function removeErrorStyling(event) {
    const inputField = event.target; // The input field that triggered the event
    inputField.classList.remove('error'); // Removes the 'error' class to clear the red border styling.

    const errorElement = document.getElementById(`${inputField.id}Error`); // Finds the associated error message element.
    if (errorElement) {
        errorElement.innerText = ''; // Resets the error message.
        errorElement.style.display = 'none'; // Hides the error message element.
    }
}

/**
 * Displays an error message when an input field contains invalid data.
 * 
 * @param {string} errorElementId - The ID of the error element to display the message.
 * @param {string} message - The error message to display.
 */
function showErrorMessage(errorElementId, message) {
    const errorElement = document.getElementById(errorElementId); // Finds the error element based on its ID
    errorElement.innerText = message; // Sets the error message
    errorElement.style.color = 'red'; // Ensures the text is red to highlight the error
    errorElement.style.display = 'block'; // Displays the error element
}

/**
 * Hides the error message for a specific error element.
 * 
 * @param {string} errorElementId - The ID of the error element to hide.
 */
function hideErrorMessage(errorElementId) {
    const errorElement = document.getElementById(errorElementId); // Finds the error element based on its ID
    errorElement.innerText = ''; // Removes the error message
}

/**
 * Validates the user input based on the field type (e.g., 'email' or 'password').
 * 
 * @param {string} variable - The type of input to validate (e.g., 'email' or 'password').
 * @param {string} value - The value entered by the user.
 * @returns {boolean} True if the input is valid, otherwise false.
 */
function validateInput(variable, value) {
    if (variable === "email") {
        // Validates if the email address is in the correct format
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
        return emailPattern.test(value); // Returns true if the email is valid
    }
    if (variable === "password") {
        return validatePassword(value); // Validates the password using its own function
    }
    return false; // Returns false if an unsupported variable type is provided
}

/**
 * Validates the password based on certain criteria (at least 8 characters, uppercase letters, lowercase letters, numbers, and special characters).
 * 
 * @param {string} password - The password to validate.
 * @returns {boolean} True if the password meets the criteria, otherwise false.
 */
function validatePassword(password) {
    const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
    return passwordPattern.test(password); // Returns true if the password matches the criteria
}

/**
 * Checks the input field for errors and displays an error message if the input is invalid.
 * 
 * @param {string} fieldID - The ID of the input field to validate.
 */
function validateEditField(fieldID) {
    let errorText = checkErrorText(fieldID); // Gets the appropriate error text for the field

    if (!validateInput(fieldID, document.getElementById(fieldID).value)) {
        showErrorMessage(`${fieldID}Error`, `${errorText}`); // Shows the error message if the input is invalid
    } else {
        hideErrorMessage(`${fieldID}Error`); // Hides the error message if the input is valid
    }
}

/**
 * Returns the error text to display for the specified field.
 * 
 * @param {string} fieldID - The ID of the field to check for error text.
 * @returns {string} The error message to display for the field.
 */
function checkErrorText(fieldID) {
    if (fieldID === "email") {
        return "Email or password is not correct! "; // Error text for invalid email
    } else if (fieldID === "password") {
        return "Email or password is not correct!."; // Error text for invalid password
    }
}

</script>

</body>
</html>
