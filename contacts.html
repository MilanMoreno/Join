<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-16">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Join project 361</title>
<!--Favicon-->
<link rel="icon" type="image/x-icon" href="./assets/img/logo_coloured.svg">
<!--Stylesheets-->

<!-- <link rel="stylesheet" href="./css/legal-Help_privacy.css" /> -->
<link rel="stylesheet" href="./css/font.css">
<link rel="stylesheet" href="./css/side_menu.css">
<link rel="stylesheet" href="./css/style.css">
<link rel="stylesheet" href="./css/contact.css">
<link rel="stylesheet" href="./css/responsive_contact.css">
<!--JS-->
<script src="./js/header.js"></script>
<style type="text/css" id="operaUserStyle"></style>

<script src="./js/contact.js"></script>
<script src="./js/contact_Mobile.js"></script>



</head>

<body onload="loadData()">
  <div w3-include-html="./assets/templates/side_menu.html">


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join</title>
    <!--Favicon-->
    <link rel="icon" type="image/x-icon" href="./assets/img/logo_coloured.svg">
    <!--Stylesheets-->
    <link rel="stylesheet" href="./css/side_menu.css">
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/style.css">
    <meta charset="UTF-8">
    <script src="./js/init.js"></script>



    <section id="containerSidebar" class="container-sidebar">
      <img src="./assets/img/logo.svg" class="sidebar-logo d-none-mobile" alt="logo_join">
      <nav>
        <a id="link-summary" href="./summary.html"><img src="./assets/img/icon_summary.svg" alt="Summary">Summary</a>
        <a id="link-task" href="./add_task.html"><img src="./assets/img/icon_addTask.svg" alt="addtask">Add Task</a>
        <a id="link-board" href="./board.html"><img src="./assets/img/icon_board.svg" alt="board">Board</a>
        <a id="link-contact" href="./contacts.html" class="bg-focus"><img src="./assets/img/icon_contacts.svg"
            alt="contacts">Contacts</a>
      </nav>
      <div class="nav-bottom-link d-none-mobile">
        <a href="./privacy-police.html" onclick="saveTheUrl()">Privacy Policy</a>
        <a href="./legal_notice.html">Legal notice</a>
      </div>
    </section>


  </div>
  <main>
    <div w3-include-html="./assets/templates/header.html" class="header-sticky">


      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Join</title>
      <!--Favicon-->
      <link rel="icon" type="image/x-icon" href="./assets/img/logo_coloured.svg">
      <!--Stylesheets-->
      <link rel="stylesheet" href="./css/header.css">
      <link rel="stylesheet" href="./css/font.css">
      <link rel="stylesheet" href="./css/style.css">
      <meta charset="UTF-8">
      <script src="./js/init.js"></script>



      <header id="header">
        <img src="./assets/img/logo_coloured.svg" alt="Join logo" class="logo-mobile">
        <p class="header-text d-none-mobile">Kanban Project Management Tool</p>
        <div class="header-right">
          <a href="./help.html" class="help-img-link cp"><img src="./assets/img/icon_help.svg" alt="help"
              class="d-none-mobile"></a>
          <div onclick="showDropdownMenu()" class="header-right-user dflex-c-c cp" id="userInitials">
            <div>M</div>
          </div>
        </div>
      </header>
      <section id="container-header-dropdown-menu" class="d-noneHead">
        <div class="header-dropdown-menu">
          <a href="./legal_notice.html">Legal Notice</a>
          <a href="./privacy-police.html">Privacy Policy</a>
          <a href="./index.html">Log out</a>
        </div>
      </section>


    </div>


    <div class="layout-wrapper" id="layout-wrapper">
      <section id="contactList" class="contacts">
        <div class="ContactAdd">
          <button onclick="togglePopUp('open', key = false)" class="enterContactButton position-fixed">Add new Contact
            <img src="./contact-assets/img/addPerson.png" alt=""></button>
        </div>

        <div class="list" id="contacts">
          <h3 class="letter"></h3>




      </section>
      <section id="contentSection" class="content-section dNone">
        <div class="h2-span">

          <div class="text">
            <h2>Contacts</h2>
            <span>Just DO It!</span>
          </div>
          <div id="mobileContactReturn" class="returnToContacts">
            <img class="closeMobile" onclick="showContactMobile()" src="contact-assets/img/close.png">
          </div>
        </div>
        <div id="content" class="contentDetails"></div>
        <div class="information" id="information"></div><!--xclass-->


      </section>
      <div id="backgroundPopUp" onclick="togglePopUp('close')" class="hideElement bg-popUp">
        <div onclick="togglePopUp(event)" class="popUp">
          <div class="popUp-icon">
            <div id="return_mobilePopUp" class="return-mobilePopUp">
              <img onclick="togglePopUp('close')" src="./contact-assets/img/close.png" alt="">
            </div>
            <div class="logo-box"><img class="logo" src="./contact-assets/img/logo.png" alt=""></div>
            <div class="logoEditBox"><img class="edit-logo" src="./contact-assets/img/add-contact.png" alt=""></div>
          </div>
          <div class="popupContainer">
            <div class="exit-button"><img onclick="togglePopUp('close')" src="./contact-assets/img/close.png" alt="">
            </div>
            <div class="pic_inputs">
              <div>
                <img class="profile-pic" src="./contact-assets/img/empty-profil.png" alt="">
              </div>
              <div class="contact_input"><!--HINZUFÜGEN eines Neuen Kontaktss(Firebase)-->
                <form class="form" id="ContactAddForm" onsubmit="ContactAdd()">
                  <input required="" id="email" placeholder="Email" type="email">
                  <input required="" id="tel" placeholder="Phone" type="tel">
                  <input required="" id="name" placeholder="Name" type="text">
                  <div class="contact_btn">
                    <button type="text" onclick="togglePopUp('close')" class="quit-Btn">Cancel <img
                        src="./contact-assets/img/close.png" alt=""></button>
                    <button type="text" id="submit" class="enterContactButton">Create Contact <img class="check"
                        src="./contact-assets/img/check.png" alt=""></button>
                    <button id="UpdBtn" class="editButton">Edit</button>
                    <button id="DelBtn" class="deleteButton">Delete</button>

                  </div>
                </form>
              </div><!--check fal-->
            </div>
          </div>
        </div>
      </div>


      <div id="backgroundPopUpEdit" onclick="togglePopUp('close', key = true)" class="hideElement bg-popUp">
        <div onclick="togglePopUp(event)" class="popUp">
          <div class="popUp-icon">
            <div id="return_editMobilePopUp" class="return-mobilePopUp">
              <img onclick="togglePopUp('close', key = true)" src="contact-assets/close.png" alt="">
            </div>
            <div class="logo-box"><img class="logo" src="./contact-assets/img/logo.png" alt=""></div>
            <div class="logoEditBox"><img class="edit-logo" src="./contact-assets/img/edit-contact.png" alt=""></div>
          </div>
          <div class="popUp-content">
            <div class="close-button"><img onclick="togglePopUp('close', key = true)" src="./contact-assets/close.png"
                alt="">
            </div>
            <div class="image_inputs">
              <div>
                <span id="letterForPopUp" class="letter_For_PopUp"></span>
              </div>
              <div class="contact_input"><!--x     aktuallisieren eines BESTEHENDEN Kontakts-->
                <form class="form" id="editContactForm" onsubmit="UpdateContact()">
                  <input required="" id="editEmail" placeholder="Email" type="email">
                  <input required="" id="editTel" placeholder="Phone" type="tel">
                  <input required="" id="editName" placeholder="Name" type="text">
                  <div class="contact_btn">
                    <button onclick="eraseContact(path ='contact', keyForEdit)" type="button" class="quit-Btn">Delete
                      <img src="./contact-assets/img/close.png" alt=""></button>
                    <button type="submit" id="submit" class="enterContactButton">Save<img class="check"
                        src="./contact-assets/img/check.png" alt=""></button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getDatabase, ref, set, get, child, update, remove } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB-Jc-sbVYfxNmL-VDeR-dR3i49UpVCdHU",
      authDomain: "creative33-9f884.firebaseapp.com",
      projectId: "creative33-9f884",
      databaseURL: "https://creative33-9f884-default-rtdb.firebaseio.com",
      storageBucket: "creative33-9f884.appspot.com",
      messagingSenderId: "975089235329",
      appId: "1:975089235329:web:ac23de9311076f9d886480"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    document.getElementById("ContactAddForm").addEventListener('submit', addContact);

    function addContact(e) {
      e.preventDefault();
      const contact = getFormData();
      saveContactToDB(contact).then(() => {
        alert("Kontakt erfolgreich hinzugefügt!");
        clearInputFields();
        fetchContacts();
      }).catch((error) => console.error("Fehler beim Hinzufügen des Kontakts: ", error));
    }

    function getFormData() {
      return {
        username: document.getElementById("name").value,
        email: document.getElementById("email").value,
        PhoneNumber: document.getElementById("tel").value
      };
    }

    function saveContactToDB(contact) {
      return set(ref(db, 'user/' + contact.username), contact);
    }

    function clearInputFields() {
      document.getElementById("name").value = "";
      document.getElementById("email").value = "";
      document.getElementById("tel").value = "";
    }

    function fetchContacts() {
      getContactsFromDB().then((contacts) => {
        displayContacts(contacts);
      }).catch((error) => console.error("Fehler beim Abrufen der Kontakte: ", error));
    }

    function getContactsFromDB() {
      const dbRef = ref(db);
      return get(child(dbRef, 'user')).then((snapshot) => snapshot.exists() ? snapshot.val() : {});
    }

    function displayContacts(contactsData) {
      const contactsList = document.getElementById("contacts");
      contactsList.innerHTML = "";
      for (const key in contactsData) {
        displayContact(contactsData[key]);
      }
    }

    function displayContact(contact) {
      const contactsList = document.getElementById("contacts");
      const contactCard = document.createElement("div");
      contactCard.classList.add("contactCard");

      contactCard.onclick = () => infoNeuContact(contact.username, contact.email, contact.PhoneNumber);

      contactCard.innerHTML = `
            <div class="single_letter" style="background-color: #AFA53D;">${contact.username.charAt(0).toUpperCase()}</div>
            <div class="fullName-email">
                <span>${contact.username}</span>
                <a class="email" href="#">${contact.email}</a>
            </div>
            <div>
             
                <button onclick="deleteContact('${contact.username}')" id="DelBtn" class="deleteButton">Delete</button>
            </div>
        `;
      contactsList.appendChild(contactCard);
    }

    function infoNeuContact(name, email, phone) {
      const contentDiv = document.getElementById("content");
      contentDiv.innerHTML = `
            <h3>Kontaktinformationen</h3>
            <p><strong>Name:</strong> ${name}</p>
            <p><strong>Email:</strong> ${email}</p>
            <p><strong>Telefonnummer:</strong> ${phone}</p>
            <div>
             <button onclick="window.location.href='PERFEKT.html'" class="editButton">Edit</button>
<button type="button" id="submix" class ="dangerbtn">Delete x</button>
<button onclick="deleteContact('contact', '-O4qBwSkkjy6CHJx9O1e')">XXX</button>
<button onclick="deleteContact(path ='contact',keyForEdit)"type="button" class="">Delete endlich</button>
                <button onclick="togglePopUp('open', key = false)" id="submi" class ="deleteButton">Delete V</button>
      <button onclick="deleteContact('contact', 'TestDelete1')">DDDD</button>
    
            </div>
        `;
    }

   

    function deleteContact(username) {
      console.log("Lösche Kontakt: ", username);


      remove(ref(db, 'user/' + username))
        .then(() => {
          alert(`Kontakt ${username} erfolgreich gelöscht!`);
          fetchContacts();
        })
        .catch((error) => {
          console.error("Fehler beim Löschen des Kontakts: ", error);
        });
    }

    window.onload = function () {
      fetchContacts();
    };

    function showContactMobile() {
      document.getElementById('contentSection').classList.add('dNone');
      document.getElementById('contactList').classList.remove('displayNone');
    }
  </script>
  <script>

    document.getElementById('submix').onclick = function () {
      firebase.database().ref('user/dsasa').remove();
    }


    
      async function deleteContact(path = 'user', id) {
    try {
        const url = `${BASE_URL}${path}/${id}.json`;
        let response = await fetch(url, {
            method: "DELETE",
            headers: {
                "content-type": "application/json",
            },
        });
        if (!response.ok) {
            throw new Error('Fehler beim Löschen des Kontakts');
        }
        window.location.reload();
    } catch (error) {
        console.error('Fehler beim Löschen des Kontakts:', error.message);
    }
}
  </script>

</body>

</html>